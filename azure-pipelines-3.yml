trigger: none

parameters:
  - name: customerName
    displayName: "Enter Customer Name (full name)"
    type: string

  - name: locationa
    displayName: "Azure Region"
    type: string
    default: "westeurope"

  - name: environment
    displayName: "Environment"
    type: string
    values:
      - dev
      - tst
      - prd
      - pprd

  - name: userEmail
    displayName: "New SFTP User Email"
    type: string

  - name: permission
    displayName: "Permission (read/write)"
    type: string
    values:
      - read
      - write

variables:
  subscriptionId: "f9ce80b6-846a-461b-a414-50be823f1223d"

pool:
  name: Default

steps:

# Step 1: Prepare Naming
- powershell: |
    $CUSTOMER       = "${{ parameters.customerName }}".ToLower().Replace(" ", "").Replace("'", "")
    $ENVIRONMENT    = "${{ parameters.environment }}"
    $LOCATION       = "${{ parameters.locationa }}"
    $PREFIX         = $CUSTOMER.Substring(0,3)
    $STORAGE        = "st$PREFIX$ENVIRONMENT$(Get-Random -Maximum 9999)"
    $RESOURCE_GROUP = "rg-$PREFIX-$ENVIRONMENT-sftp"
    $CONTAINER      = "sftp"

    Write-Host "##vso[task.setvariable variable=CUSTOMER]$CUSTOMER"
    Write-Host "##vso[task.setvariable variable=PREFIX]$PREFIX"
    Write-Host "##vso[task.setvariable variable=STORAGE]$STORAGE"
    Write-Host "##vso[task.setvariable variable=RESOURCE_GROUP]$RESOURCE_GROUP"
    Write-Host "##vso[task.setvariable variable=CONTAINER]$CONTAINER"
    Write-Host "##vso[task.setvariable variable=LOCATION]$LOCATION"
    Write-Host "##vso[task.setvariable variable=ENVIRONMENT]$ENVIRONMENT"
  displayName: "Prepare Naming Convention"

# Step 2: Create Resource Group
- task: AzureCLI@2
  displayName: "Create Resource G
